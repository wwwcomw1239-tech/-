<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ Ù…ØªÙƒØ§Ù…Ù„ ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª - Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ©">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ©</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='100' fill='%234f46e5'/><text x='50%25' y='55%25' font-size='280' text-anchor='middle' fill='white'>ğŸ“Š</text></svg>">
    
    <!-- External Resources -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/big.js@6.2.1/big.min.js"></script>
    
    <style>
        * { font-family: 'Cairo', sans-serif; }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .loading-screen.hidden { opacity: 0; visibility: hidden; }
        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top-color: #818cf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Sidebar */
        .sidebar {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .sidebar.closed { transform: translateX(100%); }
        .sidebar-overlay {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .sidebar-overlay.hidden { opacity: 0; visibility: hidden; }
        .main-content { transition: margin-right 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-item { transition: all 0.3s ease; }
        .sidebar-item:hover { transform: translateX(-5px); background: rgba(99, 102, 241, 0.3); }
        .sidebar-item.active { background: rgba(99, 102, 241, 0.5); }
        
        /* Cards & Animations */
        .card { transition: all 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        .table-row:hover { background-color: #f0f9ff; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .balanced { animation: pulse-green 1s ease-in-out; }
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
        }
        
        /* Hamburger Animation */
        .hamburger-line { transition: all 0.3s ease; }
        .hamburger.active .hamburger-line:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .hamburger.active .hamburger-line:nth-child(2) { opacity: 0; }
        .hamburger.active .hamburger-line:nth-child(3) { transform: rotate(-45deg) translate(7px, -6px); }
        
        /* Number Input */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        /* Trial Banner */
        .trial-banner { animation: slideDown 0.5s ease-out; }
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        .pulse-warning { animation: pulseWarning 2s infinite; }
        @keyframes pulseWarning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* License Page */
        .license-overlay { backdrop-filter: blur(10px); background: rgba(0, 0, 0, 0.85); }
        .glow-effect { box-shadow: 0 0 30px rgba(99, 102, 241, 0.5); }
        .hwid-box { font-family: 'Courier New', monospace; letter-spacing: 2px; }
        .float-animation { animation: float 3s ease-in-out infinite; }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Update Banner */
        .update-banner {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        /* PWA Install Button */
        .pwa-install-btn {
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Print Styles */
        @media print {
            .sidebar, .trial-banner, #main-header, .no-print { display: none !important; }
            .main-content { margin: 0 !important; padding: 20px !important; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="text-center text-white">
            <div class="loader mx-auto mb-4"></div>
            <h2 class="text-xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>
            <p class="text-indigo-300 text-sm mt-2" id="loading-status">ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</p>
        </div>
    </div>

    <!-- Update Available Banner -->
    <div id="update-banner" class="update-banner fixed top-0 left-0 right-0 z-[150] hidden">
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 px-4">
            <div class="container mx-auto flex flex-wrap items-center justify-between gap-2">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    <span id="update-message">ÙŠØªÙˆÙØ± ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯ Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ØŒ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†...</span>
                </div>
                <div class="flex items-center gap-2">
                    <span id="update-progress" class="text-sm">0%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Trial Banner -->
    <div id="trial-banner" class="trial-banner fixed top-0 left-0 right-0 z-[100] hidden">
        <div class="bg-gradient-to-r from-amber-500 to-orange-500 text-white py-2 px-4">
            <div class="container mx-auto flex flex-wrap items-center justify-between gap-2">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 pulse-warning" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <span class="font-bold">Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</span>
                </div>
                <div class="flex items-center gap-4">
                    <span id="trial-time-remaining" class="text-sm"></span>
                    <button onclick="showActivationPage()" class="bg-white text-orange-600 px-4 py-1 rounded-full text-sm font-bold hover:bg-orange-100 transition">
                        ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- License Activation Page -->
    <div id="license-page" class="license-overlay fixed inset-0 z-[200] hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full overflow-hidden fade-in my-8">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-8 text-white text-center">
                <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 float-animation">
                    <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold mb-2">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±Ø®ÙŠØµ</h2>
                <p class="text-indigo-200" id="license-status-text">Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</p>
            </div>
            
            <div class="p-8">
                <div class="mb-6">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/>
                            </svg>
                            Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ø¬Ù‡Ø§Ø² (HWID)
                        </span>
                    </label>
                    <div class="flex gap-2">
                        <input type="text" id="hwid-display" readonly class="hwid-box flex-1 px-4 py-3 bg-gray-100 border-2 border-gray-200 rounded-xl text-center font-bold text-gray-700 text-lg">
                        <button onclick="copyHWID()" class="bg-indigo-100 hover:bg-indigo-200 text-indigo-600 px-4 py-3 rounded-xl transition" title="Ù†Ø³Ø®">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2 text-center">Ø£Ø±Ø³Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ù…Ø·ÙˆØ± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Ø§Ù„ØªÙØ¹ÙŠÙ„</p>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-bold text-gray-700 mb-2">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                            </svg>
                            Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ±Ø®ÙŠØµ
                        </span>
                    </label>
                    <input type="text" id="license-key-input" placeholder="XXXX-XXXX-XXXX-XXXX" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-center font-bold text-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition uppercase" maxlength="19" oninput="formatLicenseKey(this)">
                    <p id="license-error" class="text-red-500 text-sm mt-2 text-center hidden"></p>
                </div>

                <button onclick="activateLicense()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white py-4 rounded-xl font-bold text-lg transition transform hover:scale-[1.02] glow-effect mb-4">
                    ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±Ø®ÙŠØµ
                </button>

                <a href="https://t.me/Uskdbvsu" target="_blank" class="flex items-center justify-center gap-3 w-full bg-gradient-to-r from-sky-500 to-blue-500 hover:from-sky-600 hover:to-blue-600 text-white py-4 rounded-xl font-bold transition transform hover:scale-[1.02]">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/>
                    </svg>
                    ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„ØªÙØ¹ÙŠÙ„
                </a>

                <button id="close-license-page" onclick="closeLicensePage()" class="w-full mt-4 text-gray-500 hover:text-gray-700 py-2 text-sm hidden">
                    Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©)
                </button>
            </div>
            
            <div class="bg-gray-50 px-8 py-4 text-center">
                <p class="text-xs text-gray-500">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Â© 2024 - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="hidden">
        <!-- Header -->
        <header id="main-header" class="fixed top-0 right-0 left-0 bg-gradient-to-l from-indigo-900 to-indigo-800 text-white z-40 shadow-lg">
            <div class="flex items-center justify-between px-4 py-3">
                <div class="flex items-center gap-3">
                    <button id="sidebar-toggle" onclick="toggleSidebar()" class="hamburger p-2 rounded-lg hover:bg-indigo-700 transition focus:outline-none">
                        <div class="w-6 h-5 flex flex-col justify-between">
                            <span class="hamburger-line block w-full h-0.5 bg-white rounded"></span>
                            <span class="hamburger-line block w-full h-0.5 bg-white rounded"></span>
                            <span class="hamburger-line block w-full h-0.5 bg-white rounded"></span>
                        </div>
                    </button>
                    <div class="flex items-center gap-2 cursor-pointer select-none" onclick="handleLogoClick()" title="Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-2V9h-2V7h4v10z"/>
                        </svg>
                        <div>
                            <h1 class="text-lg font-bold leading-tight">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</h1>
                            <p class="text-indigo-300 text-xs">Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ©</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <span id="offline-badge" class="hidden px-2 py-1 bg-gray-600 rounded-full text-xs">
                        <span class="inline-block w-2 h-2 bg-gray-400 rounded-full mr-1"></span>
                        ØºÙŠØ± Ù…ØªØµÙ„
                    </span>
                    <span id="license-badge" class="hidden px-3 py-1 rounded-full text-xs font-bold"></span>
                    <div class="text-sm text-indigo-200" id="current-page-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                </div>
            </div>
        </header>

        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay" class="sidebar-overlay fixed inset-0 bg-black/50 z-40 hidden lg:hidden" onclick="closeSidebar()"></div>

        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar w-72 bg-gradient-to-b from-indigo-900 to-indigo-800 fixed right-0 top-0 h-full shadow-2xl z-50 pt-16 closed lg:translate-x-0">
            <div class="p-4 border-b border-indigo-700 mt-2">
                <p class="text-indigo-300 text-sm">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
            </div>
            <nav class="p-4 space-y-2 overflow-y-auto max-h-[calc(100vh-280px)]">
                <button onclick="showPage('dashboard')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white transition" id="nav-dashboard">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                    Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </button>
                <button onclick="showPage('accounts')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white transition" id="nav-accounts">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
                </button>
                <button onclick="showPage('journal')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white transition" id="nav-journal">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                    Ø¯ÙØªØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                </button>
                <button onclick="showPage('ledger')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white transition" id="nav-ledger">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                    Ø¯ÙØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø°
                </button>
                <button onclick="showPage('trialBalance')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white transition" id="nav-trialBalance">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                    Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                </button>
                <button onclick="showPage('incomeStatement')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white transition" id="nav-incomeStatement">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                    Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„
                </button>
                <button onclick="showPage('balanceSheet')" class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-white transition" id="nav-balanceSheet">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                    Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©
                </button>
            </nav>
            
            <!-- Sidebar Footer -->
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-indigo-700 space-y-2">
                <button onclick="showBackupModal()" class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-xl text-indigo-200 hover:bg-indigo-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                    Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                </button>
                <button onclick="resetData()" class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-xl text-red-300 hover:bg-red-600 hover:text-white transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="main-content pt-20 p-4 md:p-8 min-h-screen lg:mr-72">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                    <p class="text-gray-600 mt-2">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ</p>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8">
                    <div class="card bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-4 md:p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-emerald-100 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆÙ„</p>
                                <p class="text-2xl md:text-3xl font-bold mt-2" id="total-assets">0.00</p>
                            </div>
                            <div class="bg-white/20 p-3 rounded-xl">
                                <svg class="w-6 h-6 md:w-8 md:h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.67 0-1.72 1.39-2.84 3.11-3.21V4h2.67v1.95c1.86.45 2.79 1.86 2.85 3.39H14.3c-.05-1.11-.64-1.87-2.22-1.87-1.5 0-2.4.68-2.4 1.64 0 .84.65 1.39 2.67 1.91s4.18 1.39 4.18 3.91c-.01 1.83-1.38 2.83-3.12 3.16z"/></svg>
                            </div>
                        </div>
                    </div>
                    <div class="card bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-4 md:p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-red-100 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…</p>
                                <p class="text-2xl md:text-3xl font-bold mt-2" id="total-liabilities">0.00</p>
                            </div>
                            <div class="bg-white/20 p-3 rounded-xl">
                                <svg class="w-6 h-6 md:w-8 md:h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
                            </div>
                        </div>
                    </div>
                    <div class="card bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 md:p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</p>
                                <p class="text-2xl md:text-3xl font-bold mt-2" id="total-equity">0.00</p>
                            </div>
                            <div class="bg-white/20 p-3 rounded-xl">
                                <svg class="w-6 h-6 md:w-8 md:h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                            </div>
                        </div>
                    </div>
                    <div class="card bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-4 md:p-6 text-white shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­/Ø§Ù„Ø®Ø³Ø§Ø±Ø©</p>
                                <p class="text-2xl md:text-3xl font-bold mt-2" id="net-income">0.00</p>
                            </div>
                            <div class="bg-white/20 p-3 rounded-xl">
                                <svg class="w-6 h-6 md:w-8 md:h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-2xl p-4 md:p-6 shadow-lg">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h3>
                        <canvas id="accountsChart" height="250"></canvas>
                    </div>
                    <div class="bg-white rounded-2xl p-4 md:p-6 shadow-lg">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª vs Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
                        <canvas id="revenueExpenseChart" height="250"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-4 md:p-6 shadow-lg">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-4">Ø¢Ø®Ø± Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 py-3 text-right text-sm font-semibold text-gray-600">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th class="px-4 py-3 text-right text-sm font-semibold text-gray-600">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                    <th class="px-4 py-3 text-right text-sm font-semibold text-gray-600">Ù…Ø¯ÙŠÙ†</th>
                                    <th class="px-4 py-3 text-right text-sm font-semibold text-gray-600">Ø¯Ø§Ø¦Ù†</th>
                                </tr>
                            </thead>
                            <tbody id="recent-entries"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Chart of Accounts Page -->
            <div id="page-accounts" class="page hidden fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h2>
                        <p class="text-gray-600 mt-2">Ø¥Ø¯Ø§Ø±Ø© ÙˆØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©</p>
                    </div>
                    <button onclick="openAccountModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 md:px-6 py-3 rounded-xl flex items-center gap-2 transition shadow-lg w-full sm:w-auto justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="accounts-tree"></div>
            </div>

            <!-- Journal Page -->
            <div id="page-journal" class="page hidden fade-in">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Ø¯ÙØªØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
                        <p class="text-gray-600 mt-2">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
                    </div>
                    <button onclick="openJournalModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 md:px-6 py-3 rounded-xl flex items-center gap-2 transition shadow-lg w-full sm:w-auto justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        Ù‚ÙŠØ¯ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gradient-to-l from-indigo-600 to-indigo-700 text-white">
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ù…Ø¯ÙŠÙ†</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø¯Ø§Ø¦Ù†</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="journal-entries"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Ledger Page -->
            <div id="page-ledger" class="page hidden fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Ø¯ÙØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„Ø¹Ø§Ù…</h2>
                    <p class="text-gray-600 mt-2">ØªÙØ§ØµÙŠÙ„ Ø­Ø±ÙƒØ© ÙƒÙ„ Ø­Ø³Ø§Ø¨</p>
                </div>
                <div class="mb-6">
                    <select id="ledger-account-select" onchange="renderLedger()" class="w-full md:w-1/3 px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <option value="">Ø§Ø®ØªØ± Ø­Ø³Ø§Ø¨Ø§Ù‹...</option>
                    </select>
                </div>
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div id="ledger-account-header" class="bg-gradient-to-l from-indigo-600 to-indigo-700 text-white p-4 md:p-6 hidden">
                        <h3 class="text-lg md:text-xl font-bold" id="ledger-account-name"></h3>
                        <p class="text-indigo-200" id="ledger-account-type"></p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-4 md:px-6 py-4 text-right text-sm font-semibold text-gray-600">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm font-semibold text-gray-600">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm font-semibold text-gray-600">Ù…Ø¯ÙŠÙ†</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm font-semibold text-gray-600">Ø¯Ø§Ø¦Ù†</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm font-semibold text-gray-600">Ø§Ù„Ø±ØµÙŠØ¯</th>
                                </tr>
                            </thead>
                            <tbody id="ledger-entries"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Trial Balance Page -->
            <div id="page-trialBalance" class="page hidden fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</h2>
                    <p class="text-gray-600 mt-2">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆØ§Ø²Ù† Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</p>
                </div>
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gradient-to-l from-indigo-600 to-indigo-700 text-white">
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ù…Ø¯ÙŠÙ†</th>
                                    <th class="px-4 md:px-6 py-4 text-right text-sm">Ø¯Ø§Ø¦Ù†</th>
                                </tr>
                            </thead>
                            <tbody id="trial-balance-entries"></tbody>
                            <tfoot>
                                <tr class="bg-gray-100 font-bold">
                                    <td colspan="2" class="px-4 md:px-6 py-4 text-right">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                                    <td class="px-4 md:px-6 py-4 text-right text-emerald-600" id="tb-total-debit">0.00</td>
                                    <td class="px-4 md:px-6 py-4 text-right text-red-600" id="tb-total-credit">0.00</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div id="balance-status" class="p-4 text-center font-bold"></div>
                </div>
            </div>

            <!-- Income Statement Page -->
            <div id="page-incomeStatement" class="page hidden fade-in">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„</h2>
                        <p class="text-gray-600 mt-2">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</p>
                    </div>
                    <button onclick="printReport('incomeStatement')" class="no-print bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-xl flex items-center gap-2 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                        Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-4 md:p-8">
                    <div class="text-center mb-8">
                        <h3 class="text-xl md:text-2xl font-bold text-gray-800">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„</h3>
                        <p class="text-gray-500">Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© ÙÙŠ <span id="income-date"></span></p>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-bold text-emerald-600 border-b-2 border-emerald-200 pb-2 mb-4">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h4>
                            <div id="income-revenues" class="space-y-2"></div>
                            <div class="flex justify-between font-bold text-emerald-700 mt-4 pt-2 border-t">
                                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</span>
                                <span id="total-revenues">0.00</span>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-red-600 border-b-2 border-red-200 pb-2 mb-4">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h4>
                            <div id="income-expenses" class="space-y-2"></div>
                            <div class="flex justify-between font-bold text-red-700 mt-4 pt-2 border-t">
                                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</span>
                                <span id="total-expenses">0.00</span>
                            </div>
                        </div>
                        <div class="bg-gradient-to-l from-indigo-600 to-indigo-700 text-white rounded-xl p-4 md:p-6">
                            <div class="flex justify-between text-lg md:text-xl font-bold">
                                <span>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ / (Ø§Ù„Ø®Ø³Ø§Ø±Ø©)</span>
                                <span id="net-profit">0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Balance Sheet Page -->
            <div id="page-balanceSheet" class="page hidden fade-in">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©</h2>
                        <p class="text-gray-600 mt-2">Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ù†Ø´Ø£Ø©</p>
                    </div>
                    <button onclick="printReport('balanceSheet')" class="no-print bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-xl flex items-center gap-2 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                        Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-4 md:p-8">
                    <div class="text-center mb-8">
                        <h3 class="text-xl md:text-2xl font-bold text-gray-800">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©</h3>
                        <p class="text-gray-500">ÙƒÙ…Ø§ ÙÙŠ <span id="balance-date"></span></p>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-lg font-bold text-emerald-600 border-b-2 border-emerald-200 pb-2 mb-4">Ø§Ù„Ø£ØµÙˆÙ„</h4>
                            <div id="bs-assets" class="space-y-2"></div>
                            <div class="flex justify-between font-bold text-emerald-700 mt-4 pt-2 border-t-2 border-emerald-300">
                                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆÙ„</span>
                                <span id="bs-total-assets">0.00</span>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-red-600 border-b-2 border-red-200 pb-2 mb-4">Ø§Ù„Ø®ØµÙˆÙ…</h4>
                            <div id="bs-liabilities" class="space-y-2"></div>
                            <div class="flex justify-between font-bold text-red-700 mt-4 pt-2 border-t">
                                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ…</span>
                                <span id="bs-total-liabilities">0.00</span>
                            </div>
                            <h4 class="text-lg font-bold text-blue-600 border-b-2 border-blue-200 pb-2 mb-4 mt-8">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h4>
                            <div id="bs-equity" class="space-y-2"></div>
                            <div class="flex justify-between font-bold text-blue-700 mt-4 pt-2 border-t">
                                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</span>
                                <span id="bs-total-equity">0.00</span>
                            </div>
                            <div class="flex justify-between font-bold text-purple-700 mt-6 pt-4 border-t-2 border-purple-300">
                                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙˆÙ… ÙˆØ­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</span>
                                <span id="bs-total-le">0.00</span>
                            </div>
                        </div>
                    </div>
                    <div id="bs-balance-check" class="mt-8 p-4 rounded-xl text-center font-bold"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Account Modal -->
    <div id="account-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-md p-6 fade-in">
            <h3 class="text-xl font-bold text-gray-800 mb-6">Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
            <form onsubmit="saveAccount(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                        <input type="text" id="account-code" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-indigo-500" placeholder="Ù…Ø«Ø§Ù„: 1001">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                        <input type="text" id="account-name" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-indigo-500" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                        <select id="account-type" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-indigo-500">
                            <option value="assets">Ø£ØµÙˆÙ„</option>
                            <option value="liabilities">Ø®ØµÙˆÙ…</option>
                            <option value="equity">Ø­Ù‚ÙˆÙ‚ Ù…Ù„ÙƒÙŠØ©</option>
                            <option value="revenue">Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</option>
                            <option value="expenses">Ù…ØµØ±ÙˆÙØ§Øª</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl transition">Ø­ÙØ¸</button>
                    <button type="button" onclick="closeAccountModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-xl transition">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Journal Entry Modal -->
    <div id="journal-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 overflow-y-auto p-4">
        <div class="bg-white rounded-2xl w-full max-w-4xl p-4 md:p-6 my-8 fade-in">
            <h3 class="text-xl font-bold text-gray-800 mb-6">Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠØ¯ Ù…Ø­Ø§Ø³Ø¨ÙŠ</h3>
            <form onsubmit="saveJournalEntry(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="entry-date" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø¨ÙŠØ§Ù†</label>
                        <input type="text" id="entry-description" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-indigo-500" placeholder="ÙˆØµÙ Ø§Ù„Ù‚ÙŠØ¯">
                    </div>
                </div>
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-gray-700">Ø³Ø·ÙˆØ± Ø§Ù„Ù‚ÙŠØ¯</label>
                        <button type="button" onclick="addEntryLine()" class="text-indigo-600 hover:text-indigo-800 flex items-center gap-1 text-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±
                        </button>
                    </div>
                    <div id="entry-lines" class="space-y-3"></div>
                </div>
                <div id="balance-indicator" class="p-4 rounded-xl mb-4 text-center font-bold transition-all"></div>
                <div class="flex gap-3">
                    <button type="submit" id="save-entry-btn" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl transition disabled:opacity-50 disabled:cursor-not-allowed">Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠØ¯</button>
                    <button type="button" onclick="closeJournalModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-xl transition">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Backup Modal -->
    <div id="backup-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-md p-6 fade-in">
            <h3 class="text-xl font-bold text-gray-800 mb-6">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
            <div class="space-y-4">
                <button onclick="exportData()" class="w-full flex items-center justify-center gap-3 bg-emerald-600 hover:bg-emerald-700 text-white py-4 rounded-xl transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <div class="relative">
                    <input type="file" id="import-file" accept=".json,.acbk" onchange="importData(event)" class="hidden">
                    <button onclick="document.getElementById('import-file').click()" class="w-full flex items-center justify-center gap-3 bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>
            <button onclick="closeBackupModal()" class="w-full mt-4 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-xl transition">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="fixed inset-0 z-[300] hidden items-center justify-center p-4" style="background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0d0d1f 100%);">
        <div class="bg-gray-900 rounded-3xl shadow-2xl max-w-2xl w-full overflow-hidden border border-purple-500/30 fade-in">
            <div class="bg-gradient-to-r from-purple-900 via-indigo-900 to-purple-900 p-6 text-white text-center">
                <div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg transform rotate-12">
                    <svg class="w-8 h-8 text-white transform -rotate-12" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold mb-1">ğŸ›¡ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·ÙˆØ±</h2>
                <p class="text-purple-300 text-sm">Ù…ÙˆÙ„Ø¯ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªÙØ¹ÙŠÙ„</p>
            </div>
            <div class="p-8 space-y-6">
                <div class="bg-gray-800/50 rounded-2xl p-6 border border-gray-700">
                    <label class="block text-sm font-bold text-purple-400 mb-3">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø¬Ù‡Ø§Ø² (HWID)</label>
                    <input type="text" id="admin-hwid-input" placeholder="Ù…Ø«Ø§Ù„: AC1A2B3C4D" class="w-full px-5 py-4 bg-gray-900 border-2 border-gray-600 rounded-xl text-center font-mono text-xl text-white placeholder-gray-500 focus:border-purple-500 transition uppercase">
                </div>
                <button onclick="generateKeyForHWID()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white py-4 rounded-xl font-bold text-lg transition transform hover:scale-[1.02] shadow-lg">
                    ØªÙˆÙ„ÙŠØ¯ Ù…ÙØªØ§Ø­ Ø§Ù„ØªÙØ¹ÙŠÙ„
                </button>
                <div id="admin-key-output" class="hidden">
                    <div class="bg-gradient-to-r from-emerald-900/50 to-green-900/50 rounded-2xl p-6 border border-emerald-500/30">
                        <label class="block text-sm font-bold text-emerald-400 mb-3">Ù…ÙØªØ§Ø­ Ø§Ù„ØªÙØ¹ÙŠÙ„</label>
                        <div class="flex gap-3">
                            <input type="text" id="admin-generated-key" readonly class="flex-1 px-5 py-4 bg-gray-900 border-2 border-emerald-500/50 rounded-xl text-center font-mono text-xl text-emerald-400 font-bold">
                            <button onclick="copyGeneratedKey()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-4 rounded-xl transition">Ù†Ø³Ø®</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-800/50 px-8 py-4 flex justify-end border-t border-gray-700">
                <button onclick="closeAdminPanel()" class="bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white px-4 py-2 rounded-lg transition text-sm font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Admin Login -->
    <div id="admin-login" class="fixed inset-0 z-[300] hidden items-center justify-center p-4" style="background: rgba(0,0,0,0.9);">
        <div class="bg-gray-900 rounded-2xl shadow-2xl max-w-sm w-full p-8 border border-gray-700 fade-in">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-white">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø·ÙˆØ±</h3>
            </div>
            <input type="password" id="admin-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-xl text-center text-white mb-4" onkeypress="if(event.key==='Enter')verifyAdminPassword()">
            <p id="admin-login-error" class="text-red-500 text-sm text-center mb-4 hidden">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</p>
            <div class="flex gap-3">
                <button onclick="verifyAdminPassword()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-xl font-bold transition">Ø¯Ø®ÙˆÙ„</button>
                <button onclick="closeAdminLogin()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-xl transition">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 left-4 bg-emerald-600 text-white px-6 py-3 rounded-xl shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <span id="toast-message"></span>
    </div>

    <!-- Offline Indicator -->
    <div id="offline-indicator" class="offline-indicator hidden">
        <div class="bg-gray-800 text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2">
            <span class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
            <span class="text-sm">ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„</span>
        </div>
    </div>

    <script>
        // ==================== APP VERSION ====================
        const APP_VERSION = '1.0.0';
        const VERSION_CHECK_URL = 'version.json';
        
        // ==================== PRECISION MATH WITH BIG.JS ====================
        Big.DP = 2;
        Big.RM = Big.roundHalfUp;
        
        function money(value) {
            try {
                return new Big(value || 0);
            } catch {
                return new Big(0);
            }
        }
        
        function formatMoney(value) {
            return money(value).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        // ==================== LICENSE SYSTEM ====================
        const _L = {
            TS: 'acc_ts_v2',
            LK: 'acc_lk_v2',
            HW: 'acc_hw_v2',
            SK: 'ACCSYS2024PRO',
            XK: 'ACC2024SEC',
            TD: 72 * 60 * 60 * 1000
        };
        
        function _xor(data, key) {
            let result = '';
            for (let i = 0; i < data.length; i++) {
                result += String.fromCharCode(data.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }
            return result;
        }
        
        function _enc(data) {
            return btoa(_xor(String(data), _L.XK));
        }
        
        function _dec(data) {
            try {
                return _xor(atob(data), _L.XK);
            } catch {
                return null;
            }
        }
        
        function generateHWID() {
            const stored = localStorage.getItem(_L.HW);
            if (stored) return stored;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('HWID', 2, 2);
            
            const fp = [
                navigator.userAgent,
                navigator.language,
                screen.width + 'x' + screen.height,
                screen.colorDepth,
                new Date().getTimezoneOffset(),
                navigator.hardwareConcurrency || 0,
                canvas.toDataURL().slice(-50)
            ].join('|');
            
            let hash = 0;
            for (let i = 0; i < fp.length; i++) {
                hash = ((hash << 5) - hash) + fp.charCodeAt(i);
                hash = hash & hash;
            }
            
            const hwid = 'AC' + Math.abs(hash).toString(16).toUpperCase().padStart(8, '0');
            localStorage.setItem(_L.HW, hwid);
            return hwid;
        }
        
        function generateLicenseFromHWID(hwid) {
            const combined = hwid + _L.SK;
            let hash = 0;
            for (let i = 0; i < combined.length; i++) {
                hash = ((hash << 5) - hash) + combined.charCodeAt(i);
                hash = hash & hash;
            }
            const hex = Math.abs(hash).toString(16).toUpperCase().padStart(16, '0');
            return hex.match(/.{1,4}/g).join('-');
        }
        
        async function getServerTime() {
            try {
                const response = await fetch('https://worldtimeapi.org/api/ip', { timeout: 5000 });
                const data = await response.json();
                return new Date(data.datetime).getTime();
            } catch {
                return Date.now();
            }
        }
        
        function isTrialValid() {
            const encStart = localStorage.getItem(_L.TS);
            if (!encStart) {
                localStorage.setItem(_L.TS, _enc(Date.now()));
                return true;
            }
            
            const startTime = parseInt(_dec(encStart));
            if (isNaN(startTime) || Date.now() < startTime) return false;
            
            return (Date.now() - startTime) < _L.TD;
        }
        
        function getTrialRemaining() {
            const encStart = localStorage.getItem(_L.TS);
            if (!encStart) return _L.TD;
            
            const startTime = parseInt(_dec(encStart));
            if (isNaN(startTime)) return 0;
            
            return Math.max(0, _L.TD - (Date.now() - startTime));
        }
        
        function formatRemainingTime(ms) {
            const hours = Math.floor(ms / (60 * 60 * 1000));
            const minutes = Math.floor((ms % (60 * 60 * 1000)) / (60 * 1000));
            
            if (hours > 24) {
                const days = Math.floor(hours / 24);
                return `${days} ÙŠÙˆÙ… Ùˆ ${hours % 24} Ø³Ø§Ø¹Ø©`;
            }
            return `${hours} Ø³Ø§Ø¹Ø© Ùˆ ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
        }
        
        function isActivated() {
            const encKey = localStorage.getItem(_L.LK);
            if (!encKey) return false;
            
            const storedKey = _dec(encKey);
            const validKey = generateLicenseFromHWID(generateHWID());
            return storedKey === validKey;
        }
        
        function activateLicense() {
            const input = document.getElementById('license-key-input').value.toUpperCase().trim();
            const validKey = generateLicenseFromHWID(generateHWID());
            const errorEl = document.getElementById('license-error');
            
            if (input === validKey) {
                localStorage.setItem(_L.LK, _enc(input));
                errorEl.classList.add('hidden');
                showToast('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ±Ø®ÙŠØµ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
                setTimeout(() => location.reload(), 1500);
            } else {
                errorEl.textContent = 'Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ±Ø®ÙŠØµ ØºÙŠØ± ØµØ­ÙŠØ­';
                errorEl.classList.remove('hidden');
            }
        }
        
        function formatLicenseKey(input) {
            let value = input.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
            input.value = value.match(/.{1,4}/g)?.join('-').substring(0, 19) || value;
        }
        
        function copyHWID() {
            navigator.clipboard.writeText(document.getElementById('hwid-display').value);
            showToast('ØªÙ… Ù†Ø³Ø® Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø²');
        }
        
        function showActivationPage() {
            const page = document.getElementById('license-page');
            page.classList.remove('hidden');
            page.classList.add('flex');
            document.getElementById('hwid-display').value = generateHWID();
            
            const closeBtn = document.getElementById('close-license-page');
            if (isTrialValid() && !isActivated()) {
                closeBtn.classList.remove('hidden');
                document.getElementById('license-status-text').textContent = 'ÙØ¹Ù‘Ù„ Ø§Ù„Ø¢Ù† Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±';
            } else {
                closeBtn.classList.add('hidden');
                document.getElementById('license-status-text').textContent = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©';
            }
        }
        
        function closeLicensePage() {
            if (isTrialValid()) {
                document.getElementById('license-page').classList.add('hidden');
                document.getElementById('license-page').classList.remove('flex');
            }
        }
        
        function updateTrialBanner() {
            const banner = document.getElementById('trial-banner');
            const badge = document.getElementById('license-badge');
            const header = document.getElementById('main-header');
            
            if (isActivated()) {
                banner.classList.add('hidden');
                header.style.top = '0';
                badge.textContent = 'Ù…ÙÙØ¹Ù‘Ù„ âœ“';
                badge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-emerald-500 text-white';
                badge.classList.remove('hidden');
                return;
            }
            
            if (isTrialValid()) {
                const remaining = getTrialRemaining();
                document.getElementById('trial-time-remaining').textContent = `Ù…ØªØ¨Ù‚ÙŠ: ${formatRemainingTime(remaining)}`;
                banner.classList.remove('hidden');
                header.style.top = '40px';
                
                badge.textContent = 'ØªØ¬Ø±ÙŠØ¨ÙŠ';
                badge.className = 'px-3 py-1 rounded-full text-xs font-bold bg-amber-500 text-white';
                badge.classList.remove('hidden');
                
                if (remaining < 24 * 60 * 60 * 1000) {
                    banner.querySelector('div').className = 'bg-gradient-to-r from-red-500 to-red-600 text-white py-2 px-4';
                }
            } else {
                showActivationPage();
            }
        }
        
        // ==================== ADMIN PANEL ====================
        const ADMIN_PASSWORD = 'admin2024';
        let pressedKeys = new Set();
        let logoClickCount = 0;
        
        document.addEventListener('keydown', (e) => {
            pressedKeys.add(e.code);
            if (['ControlLeft', 'ControlRight'].some(k => pressedKeys.has(k)) && 
                pressedKeys.has('ShiftLeft') && pressedKeys.has('KeyA')) {
                e.preventDefault();
                showAdminLogin();
            }
        });
        
        document.addEventListener('keyup', (e) => pressedKeys.delete(e.code));
        
        function handleLogoClick() {
            logoClickCount++;
            if (logoClickCount >= 5) {
                logoClickCount = 0;
                showAdminLogin();
            }
            setTimeout(() => logoClickCount = 0, 2000);
        }
        
        function showAdminLogin() {
            document.getElementById('admin-login').classList.remove('hidden');
            document.getElementById('admin-login').classList.add('flex');
            document.getElementById('admin-password').value = '';
            document.getElementById('admin-password').focus();
        }
        
        function closeAdminLogin() {
            document.getElementById('admin-login').classList.add('hidden');
        }
        
        function verifyAdminPassword() {
            if (document.getElementById('admin-password').value === ADMIN_PASSWORD) {
                closeAdminLogin();
                openAdminPanel();
            } else {
                document.getElementById('admin-login-error').classList.remove('hidden');
            }
        }
        
        function openAdminPanel() {
            document.getElementById('admin-panel').classList.remove('hidden');
            document.getElementById('admin-panel').classList.add('flex');
        }
        
        function closeAdminPanel() {
            document.getElementById('admin-panel').classList.add('hidden');
        }
        
        function generateKeyForHWID() {
            const hwid = document.getElementById('admin-hwid-input').value.trim().toUpperCase();
            if (!hwid || hwid.length < 4) {
                showToast('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø¬Ù‡Ø§Ø² ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            const key = generateLicenseFromHWID(hwid);
            document.getElementById('admin-generated-key').value = key;
            document.getElementById('admin-key-output').classList.remove('hidden');
            showToast('ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function copyGeneratedKey() {
            navigator.clipboard.writeText(document.getElementById('admin-generated-key').value);
            showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­');
        }
        
        // ==================== SIDEBAR ====================
        let sidebarOpen = false;
        
        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;
            updateSidebarState();
        }
        
        function closeSidebar() {
            sidebarOpen = false;
            updateSidebarState();
        }
        
        function updateSidebarState() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const toggle = document.getElementById('sidebar-toggle');
            
            if (sidebarOpen) {
                sidebar.classList.remove('closed');
                overlay.classList.remove('hidden');
                toggle.classList.add('active');
            } else {
                sidebar.classList.add('closed');
                overlay.classList.add('hidden');
                toggle.classList.remove('active');
            }
        }
        
        function handleResize() {
            const isLarge = window.innerWidth >= 1024;
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (isLarge) {
                sidebar.classList.remove('closed');
                overlay.classList.add('hidden');
                sidebarOpen = true;
            } else if (!sidebarOpen) {
                sidebar.classList.add('closed');
            }
        }
        
        window.addEventListener('resize', handleResize);
        
        // ==================== DATA MANAGEMENT ====================
        let accounts = JSON.parse(localStorage.getItem('accounts')) || [
            { code: '1001', name: 'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚', type: 'assets' },
            { code: '1002', name: 'Ø§Ù„Ø¨Ù†Ùƒ', type: 'assets' },
            { code: '1003', name: 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', type: 'assets' },
            { code: '2001', name: 'Ø§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ†', type: 'liabilities' },
            { code: '3001', name: 'Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„', type: 'equity' },
            { code: '4001', name: 'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', type: 'revenue' },
            { code: '5001', name: 'Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø±ÙˆØ§ØªØ¨', type: 'expenses' },
            { code: '5002', name: 'Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±', type: 'expenses' }
        ];
        
        let journalEntries = JSON.parse(localStorage.getItem('journalEntries')) || [];
        
        function saveData() {
            localStorage.setItem('accounts', JSON.stringify(accounts));
            localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
        }
        
        // ==================== BACKUP SYSTEM ====================
        function showBackupModal() {
            document.getElementById('backup-modal').classList.remove('hidden');
            document.getElementById('backup-modal').classList.add('flex');
        }
        
        function closeBackupModal() {
            document.getElementById('backup-modal').classList.add('hidden');
        }
        
        function exportData() {
            try {
                const data = {
                    version: (typeof APP_VERSION !== 'undefined' ? APP_VERSION : '1.0.0'),
                    exportDate: new Date().toISOString(),
                    accounts: accounts,
                    journalEntries: journalEntries
                };

                // Use standard JSON stringify without custom encryption to ensure UTF-8 support
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `accounting_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            } catch (e) {
                console.error(e);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±', 'error');
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    let data;
                    // Try parsing as standard JSON first (new format)
                    try {
                        data = JSON.parse(e.target.result);
                    } catch (jsonError) {
                        // Fallback: Try decoding if it was an old encrypted file
                        try {
                            const decrypted = _dec(e.target.result);
                            data = JSON.parse(decrypted);
                        } catch (decError) {
                            throw new Error('Invalid file format');
                        }
                    }

                    if (data && data.accounts && data.journalEntries) {
                        if (confirm('Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                            accounts = data.accounts;
                            journalEntries = data.journalEntries;
                            saveData();
                            showToast('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                            setTimeout(() => location.reload(), 1000);
                        }
                    } else {
                        showToast('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­', 'error');
                    }
                } catch {
                    showToast('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ==================== NAVIGATION ====================
        const pageTitles = {
            dashboard: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
            accounts: 'Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª',
            journal: 'Ø¯ÙØªØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©',
            ledger: 'Ø¯ÙØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø°',
            trialBalance: 'Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
            incomeStatement: 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„',
            balanceSheet: 'Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©'
        };
        
        function showPage(pageName) {
            if (!isActivated() && !isTrialValid()) {
                showActivationPage();
                return;
            }
            
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${pageName}`).classList.remove('hidden');
            
            document.querySelectorAll('[id^="nav-"]').forEach(nav => nav.classList.remove('active'));
            document.getElementById(`nav-${pageName}`).classList.add('active');
            
            document.getElementById('current-page-title').textContent = pageTitles[pageName];
            
            if (window.innerWidth < 1024) closeSidebar();
            
            switch(pageName) {
                case 'dashboard': renderDashboard(); break;
                case 'accounts': renderAccounts(); break;
                case 'journal': renderJournal(); break;
                case 'ledger': populateLedgerSelect(); break;
                case 'trialBalance': renderTrialBalance(); break;
                case 'incomeStatement': renderIncomeStatement(); break;
                case 'balanceSheet': renderBalanceSheet(); break;
            }
        }
        
        // ==================== DASHBOARD ====================
        let accountsChart, revenueExpenseChart;
        
        function renderDashboard() {
            const balances = calculateAccountBalances();
            
            let totalAssets = money(0), totalLiabilities = money(0), totalEquity = money(0);
            let totalRevenue = money(0), totalExpenses = money(0);
            
            for (const [code, balance] of Object.entries(balances)) {
                const account = accounts.find(a => a.code === code);
                if (account) {
                    const bal = money(balance);
                    switch(account.type) {
                        case 'assets': totalAssets = totalAssets.plus(bal); break;
                        case 'liabilities': totalLiabilities = totalLiabilities.plus(bal.abs()); break;
                        case 'equity': totalEquity = totalEquity.plus(bal.abs()); break;
                        case 'revenue': totalRevenue = totalRevenue.plus(bal.abs()); break;
                        case 'expenses': totalExpenses = totalExpenses.plus(bal); break;
                    }
                }
            }
            
            const netIncome = totalRevenue.minus(totalExpenses);
            totalEquity = totalEquity.plus(netIncome);
            
            document.getElementById('total-assets').textContent = formatMoney(totalAssets);
            document.getElementById('total-liabilities').textContent = formatMoney(totalLiabilities);
            document.getElementById('total-equity').textContent = formatMoney(totalEquity);
            document.getElementById('net-income').textContent = formatMoney(netIncome);
            
            const recentEntries = journalEntries.slice(-5).reverse();
            document.getElementById('recent-entries').innerHTML = recentEntries.length ? 
                recentEntries.flatMap(entry => 
                    entry.lines.map((line, i) => `
                        <tr class="table-row border-b">
                            <td class="px-4 py-3">${i === 0 ? entry.date : ''}</td>
                            <td class="px-4 py-3">${i === 0 ? entry.description : ''}</td>
                            <td class="px-4 py-3 text-emerald-600">${line.debit ? formatMoney(line.debit) : '-'}</td>
                            <td class="px-4 py-3 text-red-600">${line.credit ? formatMoney(line.credit) : '-'}</td>
                        </tr>
                    `)
                ).join('') : '<tr><td colspan="4" class="px-4 py-8 text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙˆØ¯</td></tr>';
            
            renderCharts(
                parseFloat(totalAssets),
                parseFloat(totalLiabilities),
                parseFloat(totalEquity),
                parseFloat(totalRevenue),
                parseFloat(totalExpenses)
            );
        }
        
        function renderCharts(assets, liabilities, equity, revenue, expenses) {
            const ctx1 = document.getElementById('accountsChart').getContext('2d');
            const ctx2 = document.getElementById('revenueExpenseChart').getContext('2d');
            
            if (accountsChart) accountsChart.destroy();
            if (revenueExpenseChart) revenueExpenseChart.destroy();
            
            accountsChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Ø§Ù„Ø£ØµÙˆÙ„', 'Ø§Ù„Ø®ØµÙˆÙ…', 'Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©'],
                    datasets: [{ data: [assets, liabilities, equity], backgroundColor: ['#10b981', '#ef4444', '#3b82f6'], borderWidth: 0 }]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom', rtl: true } } }
            });
            
            revenueExpenseChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', 'ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­'],
                    datasets: [{ data: [revenue, expenses, revenue - expenses], backgroundColor: ['#10b981', '#ef4444', '#6366f1'], borderRadius: 8 }]
                },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        }
        
        // ==================== ACCOUNTS ====================
        function renderAccounts() {
            const typeNames = {
                assets: { name: 'Ø§Ù„Ø£ØµÙˆÙ„', color: 'emerald', icon: 'ğŸ’°' },
                liabilities: { name: 'Ø§Ù„Ø®ØµÙˆÙ…', color: 'red', icon: 'ğŸ“‹' },
                equity: { name: 'Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©', color: 'blue', icon: 'ğŸ›ï¸' },
                revenue: { name: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', color: 'purple', icon: 'ğŸ“ˆ' },
                expenses: { name: 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', color: 'orange', icon: 'ğŸ“‰' }
            };
            
            const grouped = {};
            accounts.forEach(acc => {
                if (!grouped[acc.type]) grouped[acc.type] = [];
                grouped[acc.type].push(acc);
            });
            
            document.getElementById('accounts-tree').innerHTML = Object.entries(grouped).map(([type, accs]) => `
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-l from-${typeNames[type].color}-500 to-${typeNames[type].color}-600 text-white p-4">
                        <h3 class="text-lg font-bold">${typeNames[type].icon} ${typeNames[type].name}</h3>
                    </div>
                    <div class="p-4 space-y-2">
                        ${accs.map(acc => `
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                                <div>
                                    <span class="text-sm text-gray-500">${acc.code}</span>
                                    <p class="font-medium">${acc.name}</p>
                                </div>
                                <button onclick="deleteAccount('${acc.code}')" class="text-red-500 hover:text-red-700 p-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function openAccountModal() {
            document.getElementById('account-modal').classList.remove('hidden');
            document.getElementById('account-modal').classList.add('flex');
        }
        
        function closeAccountModal() {
            document.getElementById('account-modal').classList.add('hidden');
            document.getElementById('account-code').value = '';
            document.getElementById('account-name').value = '';
        }
        
        function saveAccount(e) {
            e.preventDefault();
            const code = document.getElementById('account-code').value;
            const name = document.getElementById('account-name').value;
            const type = document.getElementById('account-type').value;
            
            if (accounts.find(a => a.code === code)) {
                showToast('Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            accounts.push({ code, name, type });
            saveData();
            closeAccountModal();
            renderAccounts();
            showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø³Ø§Ø¨');
        }
        
        function deleteAccount(code) {
            if (confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ')) {
                accounts = accounts.filter(a => a.code !== code);
                saveData();
                renderAccounts();
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨');
            }
        }
        
        // ==================== JOURNAL ====================
        function renderJournal() {
            const tbody = document.getElementById('journal-entries');
            
            if (!journalEntries.length) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-8 text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙˆØ¯</td></tr>';
                return;
            }
            
            tbody.innerHTML = journalEntries.map((entry, idx) => 
                entry.lines.map((line, i) => `
                    <tr class="table-row border-b ${i === 0 ? 'bg-gray-50' : ''}">
                        <td class="px-4 py-3">${i === 0 ? entry.id : ''}</td>
                        <td class="px-4 py-3">${i === 0 ? entry.date : ''}</td>
                        <td class="px-4 py-3">${i === 0 ? entry.description : ''}</td>
                        <td class="px-4 py-3">${accounts.find(a => a.code === line.accountCode)?.name || line.accountCode}</td>
                        <td class="px-4 py-3 text-emerald-600">${line.debit ? formatMoney(line.debit) : ''}</td>
                        <td class="px-4 py-3 text-red-600">${line.credit ? formatMoney(line.credit) : ''}</td>
                        <td class="px-4 py-3">${i === 0 ? `<button onclick="deleteEntry(${idx})" class="text-red-500 hover:text-red-700"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>` : ''}</td>
                    </tr>
                `).join('')
            ).join('');
        }
        
        function openJournalModal() {
            document.getElementById('journal-modal').classList.remove('hidden');
            document.getElementById('journal-modal').classList.add('flex');
            document.getElementById('entry-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('entry-lines').innerHTML = '';
            addEntryLine();
            addEntryLine();
            updateBalanceIndicator();
        }
        
        function closeJournalModal() {
            document.getElementById('journal-modal').classList.add('hidden');
        }
        
        function addEntryLine() {
            const container = document.getElementById('entry-lines');
            const lineId = Date.now();
            const options = accounts.map(a => `<option value="${a.code}">${a.code} - ${a.name}</option>`).join('');
            
            container.insertAdjacentHTML('beforeend', `
                <div class="entry-line flex flex-wrap md:flex-nowrap gap-2 items-center bg-gray-50 p-3 rounded-xl" data-line-id="${lineId}">
                    <select class="line-account flex-1 min-w-[150px] px-3 py-2 rounded-lg border border-gray-300" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨...</option>
                        ${options}
                    </select>
                    <input type="number" step="0.01" min="0" placeholder="Ù…Ø¯ÙŠÙ†" class="line-debit w-full md:w-28 px-3 py-2 rounded-lg border border-gray-300" oninput="handleAmountInput(this, 'debit')">
                    <input type="number" step="0.01" min="0" placeholder="Ø¯Ø§Ø¦Ù†" class="line-credit w-full md:w-28 px-3 py-2 rounded-lg border border-gray-300" oninput="handleAmountInput(this, 'credit')">
                    <button type="button" onclick="removeEntryLine(${lineId})" class="text-red-500 hover:text-red-700 p-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            `);
        }
        
        function removeEntryLine(lineId) {
            document.querySelector(`[data-line-id="${lineId}"]`)?.remove();
            updateBalanceIndicator();
        }
        
        function handleAmountInput(input, type) {
            const line = input.closest('.entry-line');
            const other = line.querySelector(type === 'debit' ? '.line-credit' : '.line-debit');
            if (parseFloat(input.value) > 0) other.value = '';
            updateBalanceIndicator();
        }
        
        function updateBalanceIndicator() {
            let totalDebit = money(0), totalCredit = money(0);
            
            document.querySelectorAll('.entry-line').forEach(line => {
                totalDebit = totalDebit.plus(money(line.querySelector('.line-debit').value));
                totalCredit = totalCredit.plus(money(line.querySelector('.line-credit').value));
            });
            
            const indicator = document.getElementById('balance-indicator');
            const saveBtn = document.getElementById('save-entry-btn');
            const diff = totalDebit.minus(totalCredit).abs();
            
            if (totalDebit.eq(0) && totalCredit.eq(0)) {
                indicator.className = 'p-4 rounded-xl mb-4 text-center font-bold bg-gray-100 text-gray-600';
                indicator.textContent = 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆØ§Ø²Ù†';
                saveBtn.disabled = true;
            } else if (diff.eq(0)) {
                indicator.className = 'p-4 rounded-xl mb-4 text-center font-bold bg-emerald-100 text-emerald-700 balanced';
                indicator.textContent = `âœ“ Ø§Ù„Ù‚ÙŠØ¯ Ù…ØªÙˆØ§Ø²Ù† | Ù…Ø¯ÙŠÙ†: ${formatMoney(totalDebit)} = Ø¯Ø§Ø¦Ù†: ${formatMoney(totalCredit)}`;
                saveBtn.disabled = false;
            } else {
                indicator.className = 'p-4 rounded-xl mb-4 text-center font-bold bg-red-100 text-red-700';
                indicator.textContent = `âœ— ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù† | Ø§Ù„ÙØ±Ù‚: ${formatMoney(diff)}`;
                saveBtn.disabled = true;
            }
        }
        
        function saveJournalEntry(e) {
            e.preventDefault();
            
            const date = document.getElementById('entry-date').value;
            const description = document.getElementById('entry-description').value;
            const lines = [];
            
            document.querySelectorAll('.entry-line').forEach(line => {
                const accountCode = line.querySelector('.line-account').value;
                const debit = parseFloat(line.querySelector('.line-debit').value) || 0;
                const credit = parseFloat(line.querySelector('.line-credit').value) || 0;
                
                if (accountCode && (debit > 0 || credit > 0)) {
                    lines.push({ accountCode, debit, credit });
                }
            });
            
            if (lines.length < 2) {
                showToast('Ø£Ø¯Ø®Ù„ Ø³Ø·Ø±ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            const totalDebit = lines.reduce((sum, l) => money(sum).plus(l.debit), money(0));
            const totalCredit = lines.reduce((sum, l) => money(sum).plus(l.credit), money(0));
            
            if (!totalDebit.eq(totalCredit)) {
                showToast('Ø§Ù„Ù‚ÙŠØ¯ ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù†', 'error');
                return;
            }
            
            journalEntries.push({
                id: journalEntries.length + 1,
                date,
                description,
                lines
            });
            
            saveData();
            closeJournalModal();
            renderJournal();
            showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠØ¯');
        }
        
        function deleteEntry(index) {
            if (confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚ÙŠØ¯ØŸ')) {
                journalEntries.splice(index, 1);
                journalEntries.forEach((e, i) => e.id = i + 1);
                saveData();
                renderJournal();
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚ÙŠØ¯');
            }
        }
        
        // ==================== ACCOUNT BALANCES ====================
        function calculateAccountBalances() {
            const balances = {};
            
            journalEntries.forEach(entry => {
                entry.lines.forEach(line => {
                    if (!balances[line.accountCode]) balances[line.accountCode] = money(0);
                    
                    const account = accounts.find(a => a.code === line.accountCode);
                    if (account) {
                        if (['assets', 'expenses'].includes(account.type)) {
                            balances[line.accountCode] = money(balances[line.accountCode]).plus(line.debit).minus(line.credit);
                        } else {
                            balances[line.accountCode] = money(balances[line.accountCode]).plus(line.credit).minus(line.debit);
                        }
                    }
                });
            });
            
            return balances;
        }
        
        // ==================== LEDGER ====================
        function populateLedgerSelect() {
            const select = document.getElementById('ledger-account-select');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø­Ø³Ø§Ø¨Ø§Ù‹...</option>' +
                accounts.map(a => `<option value="${a.code}">${a.code} - ${a.name}</option>`).join('');
        }
        
        function renderLedger() {
            const code = document.getElementById('ledger-account-select').value;
            const tbody = document.getElementById('ledger-entries');
            const header = document.getElementById('ledger-account-header');
            
            if (!code) {
                header.classList.add('hidden');
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">Ø§Ø®ØªØ± Ø­Ø³Ø§Ø¨Ø§Ù‹</td></tr>';
                return;
            }
            
            const account = accounts.find(a => a.code === code);
            header.classList.remove('hidden');
            document.getElementById('ledger-account-name').textContent = `${account.code} - ${account.name}`;
            
            const typeNames = { assets: 'Ø£ØµÙˆÙ„', liabilities: 'Ø®ØµÙˆÙ…', equity: 'Ø­Ù‚ÙˆÙ‚ Ù…Ù„ÙƒÙŠØ©', revenue: 'Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', expenses: 'Ù…ØµØ±ÙˆÙØ§Øª' };
            document.getElementById('ledger-account-type').textContent = typeNames[account.type];
            
            let balance = money(0);
            const isDebitNormal = ['assets', 'expenses'].includes(account.type);
            const entries = [];
            
            journalEntries.forEach(entry => {
                entry.lines.filter(l => l.accountCode === code).forEach(line => {
                    if (isDebitNormal) {
                        balance = balance.plus(line.debit).minus(line.credit);
                    } else {
                        balance = balance.plus(line.credit).minus(line.debit);
                    }
                    entries.push({ date: entry.date, description: entry.description, debit: line.debit, credit: line.credit, balance: balance.toFixed(2) });
                });
            });
            
            tbody.innerHTML = entries.length ? entries.map(e => `
                <tr class="table-row border-b">
                    <td class="px-4 py-3">${e.date}</td>
                    <td class="px-4 py-3">${e.description}</td>
                    <td class="px-4 py-3 text-emerald-600">${e.debit ? formatMoney(e.debit) : '-'}</td>
                    <td class="px-4 py-3 text-red-600">${e.credit ? formatMoney(e.credit) : '-'}</td>
                    <td class="px-4 py-3 font-bold ${parseFloat(e.balance) >= 0 ? 'text-emerald-600' : 'text-red-600'}">${formatMoney(Math.abs(e.balance))}</td>
                </tr>
            `).join('') : '<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª</td></tr>';
        }
        
        // ==================== TRIAL BALANCE ====================
        function renderTrialBalance() {
            const tbody = document.getElementById('trial-balance-entries');
            const balances = calculateAccountBalances();
            
            let totalDebit = money(0), totalCredit = money(0);
            const rows = [];
            
            accounts.forEach(account => {
                const balance = money(balances[account.code] || 0);
                if (!balance.eq(0)) {
                    const isDebitNormal = ['assets', 'expenses'].includes(account.type);
                    const debit = (isDebitNormal && balance.gt(0)) || (!isDebitNormal && balance.lt(0)) ? balance.abs() : money(0);
                    const credit = (!isDebitNormal && balance.gt(0)) || (isDebitNormal && balance.lt(0)) ? balance.abs() : money(0);
                    
                    totalDebit = totalDebit.plus(debit);
                    totalCredit = totalCredit.plus(credit);
                    
                    rows.push({ code: account.code, name: account.name, debit: debit.toFixed(2), credit: credit.toFixed(2) });
                }
            });
            
            tbody.innerHTML = rows.length ? rows.map(r => `
                <tr class="table-row border-b">
                    <td class="px-4 py-3">${r.code}</td>
                    <td class="px-4 py-3">${r.name}</td>
                    <td class="px-4 py-3 text-emerald-600">${parseFloat(r.debit) ? formatMoney(r.debit) : '-'}</td>
                    <td class="px-4 py-3 text-red-600">${parseFloat(r.credit) ? formatMoney(r.credit) : '-'}</td>
                </tr>
            `).join('') : '<tr><td colspan="4" class="px-6 py-8 text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±ØµØ¯Ø©</td></tr>';
            
            document.getElementById('tb-total-debit').textContent = formatMoney(totalDebit);
            document.getElementById('tb-total-credit').textContent = formatMoney(totalCredit);
            
            const status = document.getElementById('balance-status');
            if (totalDebit.eq(totalCredit) && (totalDebit.gt(0) || totalCredit.gt(0))) {
                status.className = 'p-4 text-center font-bold bg-emerald-100 text-emerald-700';
                status.textContent = 'âœ“ Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ØªÙˆØ§Ø²Ù†';
            } else if (totalDebit.eq(0) && totalCredit.eq(0)) {
                status.className = 'p-4 text-center font-bold bg-gray-100 text-gray-600';
                status.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠÙˆØ¯';
            } else {
                status.className = 'p-4 text-center font-bold bg-red-100 text-red-700';
                status.textContent = `âœ— ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù† | Ø§Ù„ÙØ±Ù‚: ${formatMoney(totalDebit.minus(totalCredit).abs())}`;
            }
        }
        
        // ==================== INCOME STATEMENT ====================
        function renderIncomeStatement() {
            document.getElementById('income-date').textContent = new Date().toLocaleDateString('ar-SA');
            const balances = calculateAccountBalances();
            
            let totalRevenues = money(0), totalExpenses = money(0);
            const revenues = [], expenses = [];
            
            accounts.forEach(account => {
                const balance = money(balances[account.code] || 0).abs();
                if (balance.gt(0)) {
                    if (account.type === 'revenue') {
                        revenues.push({ name: account.name, amount: balance.toFixed(2) });
                        totalRevenues = totalRevenues.plus(balance);
                    } else if (account.type === 'expenses') {
                        expenses.push({ name: account.name, amount: balance.toFixed(2) });
                        totalExpenses = totalExpenses.plus(balance);
                    }
                }
            });
            
            document.getElementById('income-revenues').innerHTML = revenues.length ?
                revenues.map(r => `<div class="flex justify-between"><span>${r.name}</span><span>${formatMoney(r.amount)}</span></div>`).join('') :
                '<div class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>';
            
            document.getElementById('income-expenses').innerHTML = expenses.length ?
                expenses.map(e => `<div class="flex justify-between"><span>${e.name}</span><span>${formatMoney(e.amount)}</span></div>`).join('') :
                '<div class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª</div>';
            
            document.getElementById('total-revenues').textContent = formatMoney(totalRevenues);
            document.getElementById('total-expenses').textContent = formatMoney(totalExpenses);
            
            const netProfit = totalRevenues.minus(totalExpenses);
            document.getElementById('net-profit').textContent = formatMoney(netProfit) + (netProfit.lt(0) ? ' (Ø®Ø³Ø§Ø±Ø©)' : '');
        }
        
        // ==================== BALANCE SHEET ====================
        function renderBalanceSheet() {
            document.getElementById('balance-date').textContent = new Date().toLocaleDateString('ar-SA');
            const balances = calculateAccountBalances();
            
            let totalAssets = money(0), totalLiabilities = money(0), totalEquity = money(0);
            const assets = [], liabilities = [], equity = [];
            
            let totalRevenue = money(0), totalExpenses = money(0);
            accounts.forEach(account => {
                const balance = money(balances[account.code] || 0);
                if (account.type === 'revenue') totalRevenue = totalRevenue.plus(balance.abs());
                if (account.type === 'expenses') totalExpenses = totalExpenses.plus(balance.abs());
            });
            const netIncome = totalRevenue.minus(totalExpenses);
            
            accounts.forEach(account => {
                const balance = money(balances[account.code] || 0);
                if (!balance.eq(0)) {
                    if (account.type === 'assets') {
                        assets.push({ name: account.name, amount: balance.toFixed(2) });
                        totalAssets = totalAssets.plus(balance);
                    } else if (account.type === 'liabilities') {
                        liabilities.push({ name: account.name, amount: balance.abs().toFixed(2) });
                        totalLiabilities = totalLiabilities.plus(balance.abs());
                    } else if (account.type === 'equity') {
                        equity.push({ name: account.name, amount: balance.abs().toFixed(2) });
                        totalEquity = totalEquity.plus(balance.abs());
                    }
                }
            });
            
            if (!netIncome.eq(0)) {
                equity.push({ name: 'ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­/(Ø§Ù„Ø®Ø³Ø§Ø±Ø©)', amount: netIncome.toFixed(2) });
                totalEquity = totalEquity.plus(netIncome);
            }
            
            document.getElementById('bs-assets').innerHTML = assets.length ?
                assets.map(a => `<div class="flex justify-between"><span>${a.name}</span><span>${formatMoney(a.amount)}</span></div>`).join('') :
                '<div class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆÙ„</div>';
            
            document.getElementById('bs-liabilities').innerHTML = liabilities.length ?
                liabilities.map(l => `<div class="flex justify-between"><span>${l.name}</span><span>${formatMoney(l.amount)}</span></div>`).join('') :
                '<div class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®ØµÙˆÙ…</div>';
            
            document.getElementById('bs-equity').innerHTML = equity.length ?
                equity.map(e => `<div class="flex justify-between"><span>${e.name}</span><span class="${parseFloat(e.amount) < 0 ? 'text-red-600' : ''}">${formatMoney(e.amount)}</span></div>`).join('') :
                '<div class="text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù‚ÙˆÙ‚ Ù…Ù„ÙƒÙŠØ©</div>';
            
            document.getElementById('bs-total-assets').textContent = formatMoney(totalAssets);
            document.getElementById('bs-total-liabilities').textContent = formatMoney(totalLiabilities);
            document.getElementById('bs-total-equity').textContent = formatMoney(totalEquity);
            
            const totalLE = totalLiabilities.plus(totalEquity);
            document.getElementById('bs-total-le').textContent = formatMoney(totalLE);
            
            const check = document.getElementById('bs-balance-check');
            if (totalAssets.eq(totalLE)) {
                check.className = 'mt-8 p-4 rounded-xl text-center font-bold bg-emerald-100 text-emerald-700';
                check.textContent = 'âœ“ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ù…ØªÙˆØ§Ø²Ù†Ø©';
            } else if (totalAssets.eq(0) && totalLE.eq(0)) {
                check.className = 'mt-8 p-4 rounded-xl text-center font-bold bg-gray-100 text-gray-600';
                check.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
            } else {
                check.className = 'mt-8 p-4 rounded-xl text-center font-bold bg-red-100 text-red-700';
                check.textContent = `âœ— ØºÙŠØ± Ù…ØªÙˆØ§Ø²Ù†Ø© | Ø§Ù„ÙØ±Ù‚: ${formatMoney(totalAssets.minus(totalLE).abs())}`;
            }
        }
        
        // ==================== UTILITIES ====================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toast-message');
            
            toast.className = `fixed bottom-4 left-4 ${type === 'error' ? 'bg-red-600' : 'bg-emerald-600'} text-white px-6 py-3 rounded-xl shadow-lg transform transition-all duration-300 z-50`;
            msg.textContent = message;
            
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
        }
        
        function resetData() {
            if (confirm('Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                localStorage.removeItem('accounts');
                localStorage.removeItem('journalEntries');
                location.reload();
            }
        }
        
        function printReport(type) {
            window.print();
        }
        
        // ==================== PWA & OFFLINE ====================
        let isOnline = navigator.onLine;
        
        function updateOnlineStatus() {
            isOnline = navigator.onLine;
            const badge = document.getElementById('offline-badge');
            const indicator = document.getElementById('offline-indicator');
            
            if (isOnline) {
                badge.classList.add('hidden');
                indicator.classList.add('hidden');
            } else {
                badge.classList.remove('hidden');
                indicator.classList.remove('hidden');
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => {
                    console.log('SW registered');
                    
                    reg.addEventListener('updatefound', () => {
                        const newWorker = reg.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showUpdateBanner();
                            }
                        });
                    });
                })
                .catch(err => console.log('SW registration failed:', err));
        }
        
        function showUpdateBanner() {
            document.getElementById('update-banner').classList.remove('hidden');
            setTimeout(() => {
                location.reload();
            }, 3000);
        }
        
        // Check for updates
        async function checkForUpdates() {
            if (!navigator.onLine) return;
            
            try {
                const response = await fetch(VERSION_CHECK_URL + '?t=' + Date.now());
                const data = await response.json();
                
                if (data.version !== APP_VERSION && data.forceUpdate) {
                    document.getElementById('update-message').textContent = data.message || 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
                    showUpdateBanner();
                }
            } catch (e) {
                console.log('Update check failed:', e);
            }
        }
        
        // ==================== INITIALIZATION ====================
        async function init() {
            document.getElementById('loading-status').textContent = 'ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...';
            
            generateHWID();
            updateOnlineStatus();
            
            document.getElementById('loading-status').textContent = 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±Ø®ÙŠØµ...';
            
            await new Promise(r => setTimeout(r, 500));
            
            if (isActivated() || isTrialValid()) {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('app').classList.remove('hidden');
                handleResize();
                updateTrialBanner();
                showPage('dashboard');
                
                checkForUpdates();
                setInterval(checkForUpdates, 30 * 60 * 1000);
            } else {
                document.getElementById('loading-screen').classList.add('hidden');
                showActivationPage();
            }
            
            setInterval(updateTrialBanner, 60000);
        }
        
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
